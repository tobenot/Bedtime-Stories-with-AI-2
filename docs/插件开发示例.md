# æ’ä»¶å¼€å‘ç¤ºä¾‹

æœ¬æ–‡æ¡£é€šè¿‡å…·ä½“ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•å¼€å‘æ–°çš„æ¨¡å¼æ’ä»¶å’Œå·¥å…·æ’ä»¶ã€‚

## ç¤ºä¾‹1ï¼šè™šæ‹Ÿæ‹äººæ¨¡å¼ï¼ˆå½“å‰åº”ç”¨å…¥å£ä¸­æœªå¯ç”¨ï¼Œä»…ä½œä¸ºç¤ºä¾‹ä¿ç•™ï¼‰

### åŠŸèƒ½æè¿°

- ä¸AIå»ºç«‹è™šæ‹Ÿæ‹çˆ±å…³ç³»
- å¥½æ„Ÿåº¦ç³»ç»Ÿï¼ˆéšå¯¹è¯å˜åŒ–ï¼‰
- é€ç¤¼ç³»ç»Ÿï¼ˆå½±å“å¥½æ„Ÿåº¦ï¼‰
- ç‰¹æ®Šäº‹ä»¶è§¦å‘ï¼ˆçº¦ä¼šã€çºªå¿µæ—¥ç­‰ï¼‰

### å®ç°æ­¥éª¤

#### 1. åˆ›å»ºæ’ä»¶ç›®å½•

```
src/modes/VirtualLoverMode/
â”œâ”€â”€ index.vue                    # ä¸»ç»„ä»¶
â”œâ”€â”€ plugin.js                    # æ’ä»¶é…ç½®
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ FavorabilityPanel.vue    # å¥½æ„Ÿåº¦é¢æ¿
â”‚   â””â”€â”€ GiftSelector.vue         # ç¤¼ç‰©é€‰æ‹©å™¨
â””â”€â”€ utils/
    â””â”€â”€ favorabilityCalculator.js  # å¥½æ„Ÿåº¦è®¡ç®—é€»è¾‘
```

#### 2. å®ç°å¥½æ„Ÿåº¦è®¡ç®—é€»è¾‘

```javascript
// src/modes/VirtualLoverMode/utils/favorabilityCalculator.js

/**
 * æ ¹æ®AIå›å¤å†…å®¹åˆ†ææƒ…æ„Ÿå€¾å‘
 * @param {string} content - AIå›å¤å†…å®¹
 * @returns {number} å¥½æ„Ÿåº¦å˜åŒ–å€¼ (-10 åˆ° +10)
 */
export function analyzeSentiment(content) {
  // æ­£é¢è¯æ±‡
  const positiveWords = ['å–œæ¬¢', 'å¼€å¿ƒ', 'è°¢è°¢', 'çˆ±', 'æƒ³ä½ ', 'ç”œèœœ'];
  // è´Ÿé¢è¯æ±‡
  const negativeWords = ['è®¨åŒ', 'çƒ¦', 'ç”Ÿæ°”', 'å¤±æœ›', 'éš¾è¿‡'];
  
  let score = 0;
  
  positiveWords.forEach(word => {
    if (content.includes(word)) score += 2;
  });
  
  negativeWords.forEach(word => {
    if (content.includes(word)) score -= 2;
  });
  
  // é™åˆ¶åœ¨ -10 åˆ° +10 èŒƒå›´å†…
  return Math.max(-10, Math.min(10, score));
}

/**
 * è®¡ç®—é€ç¤¼å¸¦æ¥çš„å¥½æ„Ÿåº¦å˜åŒ–
 */
export function calculateGiftEffect(giftType) {
  const giftEffects = {
    'flower': 5,
    'chocolate': 8,
    'jewelry': 15,
    'letter': 10
  };
  
  return giftEffects[giftType] || 0;
}
```

#### 3. å®ç°å¥½æ„Ÿåº¦é¢æ¿ç»„ä»¶

```vue
<!-- src/modes/VirtualLoverMode/components/FavorabilityPanel.vue -->
<template>
  <div class="favorability-panel p-4 bg-gradient-to-br from-pink-100 to-purple-100 rounded-lg shadow-md">
    <h3 class="text-lg font-bold text-gray-800 mb-2">å…³ç³»çŠ¶æ€</h3>
    
    <!-- å¥½æ„Ÿåº¦æ¡ -->
    <div class="favorability-bar mb-4">
      <div class="flex justify-between text-sm text-gray-600 mb-1">
        <span>å¥½æ„Ÿåº¦</span>
        <span>{{ favorability }}%</span>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
        <div 
          class="h-full transition-all duration-500"
          :class="favorabilityColorClass"
          :style="{ width: favorability + '%' }"
        ></div>
      </div>
      <div class="text-center text-sm font-semibold mt-1" :class="relationshipLevelColor">
        {{ relationshipLevel }}
      </div>
    </div>
    
    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="stats grid grid-cols-2 gap-2 text-sm">
      <div class="stat-item bg-white p-2 rounded">
        <div class="text-gray-500">å¯¹è¯æ¬¡æ•°</div>
        <div class="text-lg font-bold">{{ chatCount }}</div>
      </div>
      <div class="stat-item bg-white p-2 rounded">
        <div class="text-gray-500">ç›¸è¯†å¤©æ•°</div>
        <div class="text-lg font-bold">{{ daysSinceMeet }}</div>
      </div>
    </div>
    
    <!-- é€ç¤¼æŒ‰é’® -->
    <el-button 
      class="w-full mt-4" 
      type="primary"
      @click="$emit('open-gift-selector')"
    >
      <el-icon class="mr-1"><Present /></el-icon>
      é€ç¤¼ç‰©
    </el-button>
  </div>
</template>

<script>
import { Present } from '@element-plus/icons-vue';

export default {
  name: 'FavorabilityPanel',
  components: { Present },
  props: {
    favorability: {
      type: Number,
      default: 50
    },
    chatCount: {
      type: Number,
      default: 0
    },
    createdAt: {
      type: String,
      default: ''
    }
  },
  emits: ['open-gift-selector'],
  computed: {
    favorabilityColorClass() {
      if (this.favorability < 30) return 'bg-gray-400';
      if (this.favorability < 50) return 'bg-blue-400';
      if (this.favorability < 70) return 'bg-green-400';
      if (this.favorability < 90) return 'bg-pink-400';
      return 'bg-red-400';
    },
    relationshipLevel() {
      if (this.favorability < 30) return 'é™Œç”Ÿäºº';
      if (this.favorability < 50) return 'æ™®é€šæœ‹å‹';
      if (this.favorability < 70) return 'å¥½æœ‹å‹';
      if (this.favorability < 90) return 'äº²å¯†';
      return 'çˆ±äºº';
    },
    relationshipLevelColor() {
      if (this.favorability < 30) return 'text-gray-600';
      if (this.favorability < 50) return 'text-blue-600';
      if (this.favorability < 70) return 'text-green-600';
      if (this.favorability < 90) return 'text-pink-600';
      return 'text-red-600';
    },
    daysSinceMeet() {
      if (!this.createdAt) return 0;
      const created = new Date(this.createdAt);
      const now = new Date();
      const diffTime = Math.abs(now - created);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      return diffDays;
    }
  }
};
</script>

<style scoped>
.favorability-bar {
  animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
```

#### 4. å®ç°ä¸»æ’ä»¶ç»„ä»¶

```vue
<!-- src/modes/VirtualLoverMode/index.vue -->
<template>
  <div class="virtual-lover-mode flex h-full">
    <!-- å·¦ä¾§ï¼šå¯¹è¯åŒº -->
    <div class="chat-area flex-1 flex flex-col">
      <el-main class="flex-1 overflow-y-auto p-5">
        <!-- ç©ºçŠ¶æ€ -->
        <EmptyState
          v-if="!messages.length"
          title="å¼€å§‹ä½ çš„æµªæ¼«æ•…äº‹"
          description="å’ŒAIå¼€å§‹ä¸€æ®µç‹¬ç‰¹çš„è™šæ‹Ÿæ‹çˆ±å…³ç³»"
        >
          <template #actions>
            <el-button type="primary" @click="startConversation">
              å¼€å§‹å¯¹è¯
            </el-button>
          </template>
        </EmptyState>
        
        <!-- æ¶ˆæ¯åˆ—è¡¨ -->
        <MessageBubble
          v-for="(msg, index) in messages"
          :key="index"
          :role="msg.role"
          :content="msg.content"
        >
          <template #controls="{ message }">
            <div class="flex gap-2">
              <el-tooltip content="å¤åˆ¶" placement="top">
                <el-button size="small" @click="$emit('copy-message', message.content)">
                  <el-icon><CopyDocument /></el-icon>
                </el-button>
              </el-tooltip>
            </div>
          </template>
        </MessageBubble>
        
        <!-- å¥½æ„Ÿåº¦å˜åŒ–æç¤º -->
        <transition name="fade">
          <div v-if="showFavorabilityChange" class="favorability-change-toast">
            å¥½æ„Ÿåº¦ {{ favorabilityChange > 0 ? '+' : '' }}{{ favorabilityChange }}
          </div>
        </transition>
      </el-main>
      
      <!-- è¾“å…¥åŒº -->
      <ChatInput
        v-model="inputMessage"
        :disabled="isLoading"
        :is-loading="isLoading"
        placeholder="è¯´ç‚¹ä»€ä¹ˆè®©TAå¼€å¿ƒå§..."
        @send="handleSend"
        @cancel="handleCancel"
        ref="inputRef"
      />
    </div>
    
    <!-- å³ä¾§ï¼šçŠ¶æ€é¢æ¿ -->
    <div class="status-panel w-80 border-l border-gray-200 p-4 overflow-y-auto">
      <FavorabilityPanel
        :favorability="loverData.favorability"
        :chat-count="messages.length / 2"
        :created-at="loverData.createdAt"
        @open-gift-selector="showGiftSelector = true"
      />
      
      <!-- ç‰¹æ®Šäº‹ä»¶æé†’ -->
      <div v-if="specialEvents.length" class="special-events mt-4">
        <h4 class="font-bold mb-2">ç‰¹æ®Šäº‹ä»¶</h4>
        <div 
          v-for="event in specialEvents" 
          :key="event.id"
          class="event-item p-2 bg-yellow-50 rounded mb-2"
        >
          {{ event.message }}
        </div>
      </div>
    </div>
    
    <!-- ç¤¼ç‰©é€‰æ‹©å™¨å¯¹è¯æ¡† -->
    <el-dialog v-model="showGiftSelector" title="é€‰æ‹©ç¤¼ç‰©">
      <div class="gifts grid grid-cols-2 gap-4">
        <div 
          v-for="gift in gifts" 
          :key="gift.id"
          class="gift-card p-4 border rounded cursor-pointer hover:border-pink-400 transition"
          @click="selectGift(gift)"
        >
          <div class="text-4xl text-center mb-2">{{ gift.emoji }}</div>
          <div class="text-center font-semibold">{{ gift.name }}</div>
          <div class="text-center text-sm text-gray-500">å¥½æ„Ÿåº¦ +{{ gift.effect }}</div>
        </div>
      </div>
    </el-dialog>
  </div>
</template>

<script>
import { CopyDocument } from '@element-plus/icons-vue';
import { callAiModel } from '@/core/services/aiService';
import MessageBubble from '@/shared/components/MessageBubble.vue';
import ChatInput from '@/shared/components/ChatInput.vue';
import EmptyState from '@/shared/components/EmptyState.vue';
import FavorabilityPanel from './components/FavorabilityPanel.vue';
import { analyzeSentiment, calculateGiftEffect } from './utils/favorabilityCalculator';

export default {
  name: 'VirtualLoverMode',
  components: {
    CopyDocument,
    MessageBubble,
    ChatInput,
    EmptyState,
    FavorabilityPanel
  },
  props: {
    config: Object,
    chat: Object
  },
  emits: ['copy-message'],
  data() {
    return {
      messages: [],
      inputMessage: '',
      isLoading: false,
      abortController: null,
      
      // æ‹äººæ•°æ®
      loverData: {
        favorability: 50,
        createdAt: new Date().toISOString()
      },
      
      // ç¤¼ç‰©ç³»ç»Ÿ
      gifts: [
        { id: 1, name: 'é²œèŠ±', emoji: 'ğŸŒ¹', effect: 5 },
        { id: 2, name: 'å·§å…‹åŠ›', emoji: 'ğŸ«', effect: 8 },
        { id: 3, name: 'é¦–é¥°', emoji: 'ğŸ’', effect: 15 },
        { id: 4, name: 'æƒ…ä¹¦', emoji: 'ğŸ’Œ', effect: 10 }
      ],
      showGiftSelector: false,
      
      // ç‰¹æ®Šäº‹ä»¶
      specialEvents: [],
      
      // å¥½æ„Ÿåº¦å˜åŒ–åŠ¨ç”»
      showFavorabilityChange: false,
      favorabilityChange: 0
    };
  },
  methods: {
    startConversation() {
      this.inputMessage = 'ä½ å¥½ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ~';
      this.$refs.inputRef.focus();
    },
    
    async handleSend() {
      if (!this.inputMessage.trim() || this.isLoading) return;
      
      const userMessage = {
        role: 'user',
        content: this.inputMessage.trim(),
        timestamp: new Date().toISOString()
      };
      
      this.messages.push(userMessage);
      this.inputMessage = '';
      this.isLoading = true;
      
      // æ„å»ºç³»ç»Ÿæç¤º
      const systemPrompt = {
        role: 'system',
        content: `ä½ æ˜¯ä¸€ä¸ªæ¸©æŸ”ã€å–„è§£äººæ„çš„è™šæ‹Ÿæ‹äººã€‚å½“å‰å¥½æ„Ÿåº¦ï¼š${this.loverData.favorability}ã€‚è¯·æ ¹æ®å¥½æ„Ÿåº¦è°ƒæ•´å›å¤çš„äº²å¯†ç¨‹åº¦ã€‚`
      };
      
      const assistantMessage = {
        role: 'assistant',
        content: '',
        timestamp: new Date().toISOString()
      };
      
      this.messages.push(assistantMessage);
      
      try {
        await callAiModel({
          provider: this.config.provider,
          apiKey: this.config.apiKey,
          apiUrl: this.config.apiUrl,
          model: this.config.model,
          messages: [systemPrompt, ...this.messages.slice(-10)],  // åªå‘é€æœ€è¿‘10æ¡
          temperature: 0.9,  // æ›´é«˜çš„åˆ›é€ æ€§
          maxTokens: this.config.maxTokens,
          onChunk: (chunk) => {
            Object.assign(assistantMessage, chunk);
            this.messages = [...this.messages];
          }
        });
        
        // åˆ†æAIå›å¤ï¼Œæ›´æ–°å¥½æ„Ÿåº¦
        const sentiment = analyzeSentiment(assistantMessage.content);
        this.updateFavorability(sentiment);
        
      } catch (error) {
        console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);
        this.messages.pop();  // ç§»é™¤å¤±è´¥çš„æ¶ˆæ¯
      } finally {
        this.isLoading = false;
      }
    },
    
    handleCancel() {
      if (this.abortController) {
        this.abortController.abort();
      }
    },
    
    selectGift(gift) {
      const effect = calculateGiftEffect(gift.id);
      this.updateFavorability(effect);
      
      // æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯
      this.messages.push({
        role: 'system',
        content: `ä½ é€å‡ºäº†${gift.emoji} ${gift.name}`,
        timestamp: new Date().toISOString()
      });
      
      this.showGiftSelector = false;
      
      // è§¦å‘AIå›åº”
      setTimeout(() => {
        this.inputMessage = `æˆ‘é€ä½ ${gift.name}ï¼Œå¸Œæœ›ä½ å–œæ¬¢~`;
        this.handleSend();
      }, 500);
    },
    
    updateFavorability(change) {
      this.favorabilityChange = change;
      this.loverData.favorability = Math.max(0, Math.min(100, this.loverData.favorability + change));
      
      // æ˜¾ç¤ºå˜åŒ–åŠ¨ç”»
      this.showFavorabilityChange = true;
      setTimeout(() => {
        this.showFavorabilityChange = false;
      }, 2000);
      
      // æ£€æŸ¥æ˜¯å¦è§¦å‘ç‰¹æ®Šäº‹ä»¶
      this.checkSpecialEvents();
    },
    
    checkSpecialEvents() {
      // å¥½æ„Ÿåº¦è¾¾åˆ°é‡Œç¨‹ç¢‘
      if (this.loverData.favorability === 70 && !this.hasEvent('first_date')) {
        this.specialEvents.push({
          id: 'first_date',
          message: 'ğŸ’• å¥½æ„Ÿåº¦è¾¾åˆ°70ï¼å¯ä»¥é‚€è¯·TAçº¦ä¼šäº†~'
        });
      }
      
      if (this.loverData.favorability === 90 && !this.hasEvent('confession')) {
        this.specialEvents.push({
          id: 'confession',
          message: 'ğŸ’– å¥½æ„Ÿåº¦è¾¾åˆ°90ï¼ä¹Ÿè®¸æ˜¯æ—¶å€™è¡¨ç™½äº†ï¼Ÿ'
        });
      }
    },
    
    hasEvent(eventId) {
      return this.specialEvents.some(e => e.id === eventId);
    }
  }
};
</script>

<style scoped>
.favorability-change-toast {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 1rem 2rem;
  border-radius: 0.5rem;
  font-size: 1.5rem;
  font-weight: bold;
  z-index: 9999;
}

.fade-enter-active, .fade-leave-active {
  transition: opacity 0.5s;
}

.fade-enter-from, .fade-leave-to {
  opacity: 0;
}
</style>
```

#### 5. ç¼–å†™æ’ä»¶é…ç½®

```javascript
// src/modes/VirtualLoverMode/plugin.js
import VirtualLoverMode from './index.vue';

export default {
  id: 'virtual-lover',
  name: 'è™šæ‹Ÿæ‹äºº',
  description: 'ä¸AIå»ºç«‹æ¸©é¦¨çš„è™šæ‹Ÿæ‹çˆ±å…³ç³»ï¼Œä½“éªŒç‹¬ç‰¹çš„æƒ…æ„Ÿäº’åŠ¨',
  icon: 'ChatDotRound',
  version: '1.0.0',
  author: 'tobenot',
  component: VirtualLoverMode,
  config: {
    supportFavorability: true,
    supportGifts: true,
    supportSpecialEvents: true
  }
};
```

#### 6. æ³¨å†Œæ’ä»¶

```javascript
// src/modes/index.js
import VirtualLoverMode from './VirtualLoverMode/plugin';

export function registerAllModes() {
  pluginSystem.register(StandardChatMode);
  pluginSystem.register(VirtualLoverMode);  // â† æ·»åŠ è¿™è¡Œ
}
```

å®Œæˆï¼ç°åœ¨ä½ å¯ä»¥åœ¨æ¨¡å¼é€‰æ‹©å™¨ä¸­çœ‹åˆ°å¹¶ä½¿ç”¨"è™šæ‹Ÿæ‹äºº"æ¨¡å¼äº†ã€‚

## ç¤ºä¾‹2ï¼šéª°å­å·¥å…·

### åŠŸèƒ½æè¿°

- æ”¯æŒå¤šç§éª°å­è§„åˆ™ï¼ˆD20ã€3D6ç­‰ï¼‰
- è‡ªåŠ¨è®¡ç®—ç»“æœ
- å¯æ’å…¥åˆ°å¯¹è¯ä¸­

### å®ç°æ­¥éª¤

#### 1. åˆ›å»ºå·¥å…·ç»„ä»¶

```vue
<!-- src/tools/DiceRollerTool/index.vue -->
<template>
  <div class="dice-roller-tool">
    <el-button 
      class="tool-button"
      @click="visible = true"
    >
      <el-icon><Trophy /></el-icon>
      <span>éª°å­</span>
    </el-button>
    
    <el-dialog v-model="visible" title="æ·éª°å­" width="400px">
      <div class="dice-config">
        <el-form :model="form" label-width="80px">
          <el-form-item label="éª°å­ç±»å‹">
            <el-select v-model="form.diceType" class="w-full">
              <el-option label="D4 (4é¢éª°)" value="D4" />
              <el-option label="D6 (6é¢éª°)" value="D6" />
              <el-option label="D8 (8é¢éª°)" value="D8" />
              <el-option label="D10 (10é¢éª°)" value="D10" />
              <el-option label="D12 (12é¢éª°)" value="D12" />
              <el-option label="D20 (20é¢éª°)" value="D20" />
              <el-option label="D100 (ç™¾é¢éª°)" value="D100" />
            </el-select>
          </el-form-item>
          
          <el-form-item label="æ•°é‡">
            <el-input-number v-model="form.count" :min="1" :max="10" class="w-full" />
          </el-form-item>
          
          <el-form-item label="ä¿®æ­£å€¼">
            <el-input-number v-model="form.modifier" :min="-10" :max="10" class="w-full" />
          </el-form-item>
        </el-form>
        
        <!-- ç»“æœå±•ç¤º -->
        <div v-if="result" class="result-display mt-4 p-4 bg-gray-50 rounded">
          <div class="text-lg font-bold text-center mb-2">
            {{ form.count }}{{ form.diceType }} {{ form.modifier >= 0 ? '+' : '' }}{{ form.modifier }}
          </div>
          <div class="dice-results flex justify-center gap-2 mb-2">
            <span 
              v-for="(roll, i) in result.rolls" 
              :key="i"
              class="dice-value px-3 py-1 bg-blue-500 text-white rounded font-bold"
            >
              {{ roll }}
            </span>
          </div>
          <div class="text-2xl font-bold text-center text-blue-600">
            æ€»è®¡: {{ result.total }}
          </div>
        </div>
      </div>
      
      <template #footer>
        <el-button @click="visible = false">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="rollDice">æŠ•æ·</el-button>
        <el-button v-if="result" type="success" @click="insertResult">æ’å…¥ç»“æœ</el-button>
      </template>
    </el-dialog>
  </div>
</template>

<script>
import { Trophy } from '@element-plus/icons-vue';

export default {
  name: 'DiceRollerTool',
  components: { Trophy },
  emits: ['insert-text'],
  data() {
    return {
      visible: false,
      form: {
        diceType: 'D20',
        count: 1,
        modifier: 0
      },
      result: null
    };
  },
  methods: {
    rollDice() {
      const max = parseInt(this.form.diceType.substring(1));
      const rolls = [];
      
      for (let i = 0; i < this.form.count; i++) {
        rolls.push(Math.floor(Math.random() * max) + 1);
      }
      
      const sum = rolls.reduce((a, b) => a + b, 0);
      const total = sum + this.form.modifier;
      
      this.result = {
        rolls,
        sum,
        total
      };
    },
    
    insertResult() {
      const text = `[éª°å­: ${this.form.count}${this.form.diceType}${this.form.modifier >= 0 ? '+' : ''}${this.form.modifier} = ${this.result.total}]`;
      this.$emit('insert-text', text);
      this.visible = false;
      this.result = null;
    }
  }
};
</script>

<style scoped>
.tool-button {
  display: flex;
  align-items: center;
  gap: 4px;
}

.dice-value {
  animation: roll 0.5s ease-out;
}

@keyframes roll {
  0% { transform: rotateX(0deg); }
  100% { transform: rotateX(360deg); }
}
</style>
```

#### 2. ç¼–å†™å·¥å…·é…ç½®

```javascript
// src/tools/DiceRollerTool/tool.js
import DiceRollerTool from './index.vue';

export default {
  id: 'dice-roller',
  name: 'éª°å­',
  description: 'æ·éª°å­è¿›è¡Œéšæœºæ£€å®šï¼Œæ”¯æŒå¤šç§éª°å­è§„åˆ™',
  icon: 'Trophy',
  version: '1.0.0',
  component: DiceRollerTool,
  compatibleModes: ['standard-chat', 'game-mode', 'virtual-lover'],
  handler: (context, result) => {
    return result;  // è¿”å›è¦æ’å…¥çš„æ–‡æœ¬
  }
};
```

#### 3. æ³¨å†Œå·¥å…·

```javascript
// src/tools/index.js
import DiceRollerTool from './DiceRollerTool/tool';

export function registerAllTools() {
  toolRegistry.register(ScriptSelectorTool);
  toolRegistry.register(DiceRollerTool);  // â† æ·»åŠ è¿™è¡Œ
}
```

#### 4. åœ¨æ¨¡å¼ä¸­ä½¿ç”¨å·¥å…·

åœ¨ä»»ä½•æ¨¡å¼çš„è¾“å…¥æ¡†å·¥å…·æ ä¸­é›†æˆï¼š

```vue
<ChatInput
  v-model="inputMessage"
  @send="handleSend"
>
  <template #toolbar>
    <div class="tools flex gap-2">
      <!-- åŠ¨æ€åŠ è½½å…¼å®¹çš„å·¥å…· -->
      <component
        v-for="tool in compatibleTools"
        :key="tool.id"
        :is="tool.component"
        @insert-text="handleToolInsert"
      />
    </div>
  </template>
</ChatInput>

<script>
import { getToolsForMode } from '@/tools';

export default {
  computed: {
    compatibleTools() {
      return getToolsForMode(this.$options.name);
    }
  },
  methods: {
    handleToolInsert(text) {
      this.inputMessage += text;
    }
  }
};
</script>
```

## æ€»ç»“

é€šè¿‡è¿™äº›ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼š

1. **æ¨¡å¼æ’ä»¶**æä¾›å®Œæ•´çš„åŠŸèƒ½ä½“éªŒï¼ˆå¦‚è™šæ‹Ÿæ‹äººæ¨¡å¼ï¼‰
2. **å·¥å…·æ’ä»¶**æä¾›å¯å¤ç”¨çš„å°åŠŸèƒ½ï¼ˆå¦‚éª°å­å·¥å…·ï¼‰
3. **å…±äº«ç»„ä»¶**åœ¨ä¸åŒæ’ä»¶é—´å¤ç”¨ï¼ˆMessageBubbleã€ChatInputç­‰ï¼‰
4. **æ ¸å¿ƒæœåŠ¡**ç»Ÿä¸€å¤„ç†åº•å±‚é€»è¾‘ï¼ˆAIè°ƒç”¨ï¼‰

è¿™ç§æ¶æ„è®©å¼€å‘æ–°åŠŸèƒ½å˜å¾—ç®€å•ã€å¿«é€Ÿã€å¯ç»´æŠ¤ï¼

