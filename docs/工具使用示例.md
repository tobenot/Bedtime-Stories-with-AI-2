# 工具类使用示例

## 在标准对话模式中使用AbortManager

```javascript
import { createAbortManager } from '@/utils/modeHelpers';

export default {
  data() {
    return {
      abortManager: createAbortManager()
    };
  },
  methods: {
    async handleSend() {
      const controller = this.abortManager.create();
      
      try {
        await callAiModel({
          signal: controller.signal,
          onChunk: (chunk) => {
            console.log(chunk);
          }
        });
      } finally {
        this.abortManager.abort();
      }
    },
    
    handleCancel() {
      this.abortManager.abort();
    }
  }
};
```

## 在虚拟恋人模式中使用流式JSON解析

```javascript
import { createStreamJsonParser, createThrottle } from '@/utils/modeHelpers';

export default {
  data() {
    return {
      jsonParser: createStreamJsonParser(),
      throttleManager: createThrottle(50)
    };
  },
  methods: {
    async handleSend() {
      this.jsonParser.reset();
      
      await callAiModel({
        onChunk: (chunk) => {
          this.jsonParser.appendChunk(chunk.content);
          
          this.throttleManager.execute(() => {
            this.updateUI();
          });
        }
      });
      
      const finalData = this.jsonParser.parseComplete();
      console.log('解析结果:', finalData);
    }
  }
};
```

## 使用元数据管理器保存游戏状态

```javascript
import { createMetadataManager } from '@/utils/modeHelpers';

export default {
  mounted() {
    this.gameMetadata = createMetadataManager(this.chat, 'gameState');
    
    const level = this.gameMetadata.get('level', 1);
    const hp = this.gameMetadata.get('hp', 100);
  },
  methods: {
    levelUp() {
      const currentLevel = this.gameMetadata.get('level', 1);
      this.gameMetadata.set('level', currentLevel + 1);
    },
    
    saveGameState(state) {
      this.gameMetadata.setAll(state);
    }
  }
};
```

## 优化滚动性能

```javascript
import { createScrollManager } from '@/utils/modeHelpers';

export default {
  mounted() {
    this.scrollManager = createScrollManager(this.$refs.container);
  },
  methods: {
    handleNewMessage() {
      if (this.scrollManager.isNearBottom(100)) {
        this.scrollManager.scrollToBottom();
      }
    },
    
    handleScroll() {
      const showButton = this.scrollManager.shouldShowScrollButton(150);
      this.$emit('scroll-bottom-changed', showButton);
    }
  }
};
```

