# 重构文件清单

## ✨ 新增文件

### 核心架构文件

```
src/core/
├── services/
│   └── aiService.js              # 核心AI服务（统一的AI接口）
├── pluginSystem.js               # 插件系统（注册、加载、管理）
└── store.js                      # 全局状态管理
```

### 模式插件

```
src/modes/
├── StandardChatMode/
│   ├── index.vue                 # 标准对话模式主组件
│   ├── plugin.js                 # 插件配置
│   └── components/
│       └── MessageControls.vue   # 消息控制按钮
└── index.js                      # 模式注册中心
```

### 共享组件

```
src/shared/
└── components/
    ├── MessageBubble.vue         # 可复用的消息气泡
    ├── ChatInput.vue             # 可复用的输入框
    ├── MarkdownRenderer.vue      # Markdown渲染器
    ├── EmptyState.vue            # 空状态组件
    └── index.js                  # 组件导出
```

### 工具插件

```
src/tools/
├── ScriptSelectorTool/
│   ├── index.vue                 # 剧本选择器工具
│   └── tool.js                   # 工具配置
└── index.js                      # 工具注册中心
```

### 主应用

```
src/
└── AppCore.vue                   # 微内核主应用
```

### 文档

```
docs/
├── 架构说明.md                   # 详细的架构设计文档
├── 插件开发示例.md               # 完整的插件开发示例
├── 快速开始.md                   # 快速上手指南
└── 重构文件清单.md               # 本文件

根目录/
├── REFACTORING_GUIDE.md          # 重构指南
└── README_NEW_ARCHITECTURE.md    # 新架构README
```

## 🔄 修改的文件

### src/main.js
- ✅ 更新为使用 `AppCore.vue` 而不是 `App.vue`

### src/utils/aiService.js
- ✅ 重构为向后兼容层，转发调用到 `core/services/aiService.js`
- ✅ 保持原有API不变，确保向后兼容

## 📦 保留的文件

### src/App.vue
- ✅ 保留作为参考
- ✅ 所有功能已迁移到 `AppCore.vue` 和 `StandardChatMode`
- ⚠️ 不再被使用，但保留用于对比和参考

### src/components/
所有原有的全局组件保持不变：
- ✅ SettingsDrawer.vue
- ✅ HeaderBar.vue
- ✅ ChatSidebar.vue
- ✅ ModelSelector.vue
- ✅ ScriptSelector.vue
- ✅ LocalScriptEditor.vue
- ✅ TxtNovelExporter.vue
- ✅ MarkdownTool.vue
- ✅ EditMessageDialog.vue
- ✅ AuthorDialog.vue
- ✅ ChatItem.vue

### src/utils/
所有工具函数保持不变：
- ✅ keyManager.js
- ✅ markdown.js
- ✅ pdfExporter.js
- ✅ txtExporter.js
- ✅ scriptPreview.js
- ✅ archive.js
- ✅ providers/ (deepseek.js, gemini.js)

### src/config/
配置文件保持不变：
- ✅ constants.js
- ✅ scripts.js

## 📊 统计

### 新增文件数量
- 核心文件: 3 个
- 模式插件: 4 个
- 共享组件: 5 个
- 工具插件: 2 个
- 主应用: 1 个
- 文档: 6 个
- **总计: 21 个新文件**

### 修改文件数量
- 核心文件: 2 个 (main.js, utils/aiService.js)

### 代码行数变化
- 原 App.vue: ~991 行
- 新架构:
  - AppCore.vue: ~600 行 (简化了逻辑)
  - StandardChatMode: ~200 行 (独立模式)
  - 核心服务: ~300 行
  - 共享组件: ~300 行
  - **总计: ~1400 行**（增加了约 400 行，但提升了可维护性和可扩展性）

## 🎯 架构改进

### 模块化程度
- **之前**: 单一 App.vue 包含所有逻辑
- **现在**: 
  - 微内核: 负责协调
  - 插件: 独立的功能模块
  - 共享组件: 可复用的UI
  - 核心服务: 统一的底层能力

### 耦合度
- **之前**: 高耦合，所有功能交织在一起
- **现在**: 低耦合，清晰的模块边界

### 可扩展性
- **之前**: 添加新功能需要修改 App.vue
- **现在**: 创建新插件，无需修改现有代码

### 可维护性
- **之前**: 代码集中，难以定位和修改
- **现在**: 职责明确，易于维护和调试

### 复用性
- **之前**: UI组件难以复用
- **现在**: 共享组件库，统一的UI体验

## 🔍 关键设计决策

### 1. 为什么选择微内核架构？
- ✅ 核心功能最小化
- ✅ 功能通过插件扩展
- ✅ 插件可以独立开发和测试
- ✅ 支持热插拔

### 2. 为什么分离共享组件？
- ✅ 避免代码重复
- ✅ 保持UI一致性
- ✅ 提升开发效率
- ✅ 便于维护和更新

### 3. 为什么保留原有文件？
- ✅ 向后兼容
- ✅ 作为参考
- ✅ 平滑过渡
- ✅ 降低风险

### 4. 为什么创建工具系统？
- ✅ 小功能可复用
- ✅ 跨模式共享
- ✅ 灵活组合
- ✅ 易于扩展

## 📝 迁移清单

### 已完成 ✅
- [x] 核心AI服务抽取
- [x] 插件系统建立
- [x] 标准对话模式迁移
- [x] 共享组件创建
- [x] 工具系统搭建
- [x] 微内核实现
- [x] 向后兼容层
- [x] 完整文档

### 可选优化 📋
- [ ] 插件懒加载
- [ ] 代码分割优化
- [ ] 性能监控
- [ ] 单元测试
- [ ] E2E测试
- [ ] TypeScript支持
- [ ] 插件热重载

## 🎉 总结

重构成功完成！新架构具备：

1. **清晰的模块划分** - 每个模块职责明确
2. **强大的扩展能力** - 轻松添加新功能
3. **良好的代码复用** - 共享组件和服务
4. **完善的文档支持** - 详细的开发指南
5. **向后兼容保证** - 平滑过渡，零风险

现在你可以：
- ✨ 快速开发新模式（虚拟恋人、游戏等）
- 🔧 添加实用工具（骰子、生图等）
- 🎨 创建自定义UI
- 🚀 构建插件生态

**开始你的创造之旅吧！** 🎯

